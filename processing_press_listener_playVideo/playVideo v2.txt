import processing.serial.*;
import processing.video.*;

Serial mySerial;
char inByte;
Movie mov;
boolean playToStop=false;
PImage blkImg;
String[] videoList;

//test
Movie[] movArray;
int index;
Movie temp;

void setup() {

  size(displayWidth, displayHeight);
  frameRate(30);
  mySerial=new Serial(this, "COM3", 9600);
  background(0);
  //blkImg=loadImage("photo/black.png");
  //image (blkImg, 0, 0, width, height);
  println("width and height: "+width+" "+height);
  
  //test
//  temp=new Movie(this, "video/transit.mov");
//  temp.loop();
  
  // load videos in folder
  index=0;
  String[] videoListTemp=getListOfItemsInFolder("/video");
  movArray = new Movie[videoListTemp.length];
  for(int i=0;i<videoListTemp.length;i++){
    movArray[i] = new Movie(this,"video/"+videoListTemp[i]);
  }
}

void draw() {

  if (inByte=='0') {
      background(0);
      //image (blkImg, 0, 0, width, height);
      if (playToStop) {
        movArray[index].stop();
        playToStop=false;
      }
      
      // randomize video to play
      index = int(random(movArray.length));
      println("index="+index);      
    }
    else if (inByte=='1') {
      println("play");      
      playOneFrame();
      playToStop=true;
    }
  while (mySerial.available () > 0) {
    inByte = mySerial.readChar();
    println("inByte="+inByte);
  }
}

void playOneFrame() {  
  println(index);
  movArray[index].play(); 
  image (movArray[index], 0, 0, width, height);
}

void movieEvent(Movie m) {
  //println("movie Event");
  m.read();
}

String[] getListOfItemsInFolder(String path) {
  File dir = new File(dataPath(path));
  String[] list = dir.list();

  if (list == null) {
    println("Folder does not exist or cannot be accessed.");
    println(path);
  } else {
    println(list);
  }
  return list;
}
